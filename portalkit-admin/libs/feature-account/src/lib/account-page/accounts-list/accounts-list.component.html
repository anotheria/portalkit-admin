<form nz-form [nzLayout]="'inline'" [formGroup]="searchForm" (ngSubmit)="submitFilterForm()">
  <nz-form-item>
    <nz-form-control>
      <nz-input-group [nzSuffix]="suffixIconSearch">
        <input type="text" formControlName="searchTerm" nz-input placeholder="search text" />
      </nz-input-group>
      <ng-template #suffixIconSearch>
        <span nz-icon nzType="search"></span>
      </ng-template>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-control>
      <nz-range-picker formControlName="registrationRange"></nz-range-picker>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-control>
      <nz-select nzMode="multiple"
                 nzAllowClear
                 nzServerSearch
                 formControlName="includedStatuses" nzPlaceHolder="Included statuses">
        <ng-container *ngFor="let o of (statusesList$ | async)">
          <nz-option [nzValue]="o.name" [nzLabel]="o.name"></nz-option>
        </ng-container>
      </nz-select>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-control>
      <nz-select nzMode="multiple"
                 nzAllowClear
                 nzServerSearch
                 formControlName="excludedStatuses" nzPlaceHolder="Excluded statuses">
        <ng-container *ngFor="let o of (statusesList$ | async)">
          <nz-option [nzValue]="o.name" [nzLabel]="o.name"></nz-option>
        </ng-container>
      </nz-select>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-control>
      <button nz-button nzType="primary" [disabled]="!searchForm.valid">Submit</button>
    </nz-form-control>
  </nz-form-item>
</form>

<ng-template #rangeTemplate let-range="range" let-total>
  {{ range[0] }}-{{ range[1] }} of {{ total }} items
</ng-template>

<nz-table
  #basicTable
  [nzData]="accountList.content"
  nzPaginationPosition="both"
  nzShowSizeChanger="true"
  nzSize="small"
  [nzShowTotal]="rangeTemplate"
  nzFrontPagination="false"
  [nzLoading]="loading"
  [nzTotal]="total"
  [nzPageSize]="pageSize"
  [nzPageIndex]="pageIndex"
  (nzQueryParams)="onQueryParamsChange($event)"
>
  <thead>
    <tr>
      <th>Account Id</th>
      <th nzColumnKey="EMAIL" [nzSortFn]="true">email</th>
      <th nzColumnKey="TYPE" [nzSortFn]="true">Type</th>
      <th nzColumnKey="STATUS" [nzSortFn]="true">Status</th>
      <th nzColumnKey="REGISTRATION_DATE" [nzSortFn]="true">Registered</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of basicTable.data">
      <td>
        <a [routerLink]="['/', { outlets: { overlay: ['accounts', data.accountId.internalId, 'edit'] } }]"
        >{{ data.accountId.internalId }}</a></td>
      <td>{{ data.email }}</td>
      <td>{{ data.type }}</td>
      <td><span *ngFor="let s of data.statuses" nz-tooltip [nzTooltipTitle]="s.toString()">{{s.toString()[0]}}</span></td>
      <td>{{ data.registrationTimestamp | date : "yyyy-MM-dd hh:mm:ss" }}</td>
      <td>
        <button
          nz-button
          nzType="link"
          nzSize="small"
          nzTooltipTitle="Edit"
          nzTooltipPlacement="top"
          nz-tooltip
          [routerLink]="['/', { outlets: { overlay: ['accounts', data.accountId.internalId, 'edit'] } }]"
        >
          <span nz-icon nzType="edit" nzTheme="outline"></span>
        </button>

        <button nz-button nzType="link" nzSize="small" nzTooltipTitle="Sign-in as" nzTooltipPlacement="top" nz-tooltip
          (click)="onSignInAs(data.accountId.internalId)">
          <span nz-icon nzType="login" nzTheme="outline"></span>
        </button>

        <button
          nz-button
          nzType="link"
          nzSize="small"
          nzTooltipTitle="Set password"
          nzTooltipPlacement="top"
          nz-tooltip
          [routerLink]="['/', { outlets: { overlay: ['accounts', data.accountId.internalId, 'set-password'] } }]"
        >
          <span nz-icon nzType="lock" nzTheme="outline"></span>
        </button>
        <!--
        <button
          nz-button
          nzType="link"
          nzSize="small"
          nzTooltipTitle="Password recovery"
          nzTooltipPlacement="top"
          nz-tooltip
        >
          <span nz-icon nzType="rollback" nzTheme="outline"></span>
        </button>
        -->
        <button
          nz-button
          nzType="link"
          nzSize="small"
          nzTooltipTitle="Data-spaces"
          nzTooltipPlacement="top"
          nz-tooltip
          [routerLink]="['/', { outlets: { overlay: ['accounts', data.accountId.internalId, 'data-space'] } }]"
        >
          <span nz-icon nzType="database" nzTheme="outline"></span>
        </button>
      </td>
    </tr>
  </tbody>
</nz-table>
