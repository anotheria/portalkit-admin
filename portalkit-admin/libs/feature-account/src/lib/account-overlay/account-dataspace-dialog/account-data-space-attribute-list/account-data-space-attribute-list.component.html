<ng-template #rangeTemplate let-range="range" let-total>
  {{ range[0] }}-{{ range[1] }} of {{ total }} items
</ng-template>

<nz-table
  nzSize="small"
  nzShowPagination="true"
  nzHideOnSinglePage="true"
  [nzShowTotal]="rangeTemplate"
  #editRowTable
  nzBordered
  [nzData]="attributes"
>
  <thead>
    <tr>
      <th nzWidth="30%">Name</th>
      <th>Value</th>
      <th>Type</th>
      <th class="th-actions">
        Action
        <button
          nz-button
          nzType="primary"
          nzSize="small"
          nzShape="circle"
          nzTooltipTitle="Add attribute"
          nzTooltipPlacement="right"
          nz-tooltip
          (click)="addRow()"
        >
          <span nz-icon nzType="plus"></span>
        </button>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of editRowTable.data">
      <td>
        <ng-container *ngIf="!editCache[data.id].edit || data.name">{{ data.name }}</ng-container>
        <ng-container *ngIf="editCache[data.id].edit && !data.name">
          <input type="text" nz-input [(ngModel)]="editCache[data.id].data.name" />
        </ng-container>
      </td>
      <td>
        <ng-container *ngIf="!editCache[data.id].edit">{{ data.valueAsString }}</ng-container>
        <ng-container *ngIf="editCache[data.id].edit">
          <input type="text" nz-input [(ngModel)]="editCache[data.id].data.valueAsString" />
        </ng-container>
      </td>
      <td>
        <ng-container *ngIf="!editCache[data.id].edit || data.type">{{ data.type }}</ng-container>
        <ng-container *ngIf="editCache[data.id].edit && !data.type">
          <nz-select [(ngModel)]="editCache[data.id].data.type">
            <ng-container *ngFor="let o of attributeTypeOptions">
              <nz-option [nzValue]="o.value" [nzLabel]="o.label"></nz-option>
            </ng-container>
          </nz-select>
        </ng-container>
      </td>
      <td>
        <ng-container *ngIf="!editCache[data.id].edit">
          <button
            nz-button
            nzType="link"
            nzSize="small"
            nzTooltipTitle="Edit"
            nzTooltipPlacement="top"
            nz-tooltip
            (click)="startEdit(data.id)"
          >
            <span nz-icon nzType="edit" nzTheme="outline"></span>
          </button>
          <button
            nz-button
            nzType="link"
            nzSize="small"
            nzTooltipTitle="Delete attribute"
            nzTooltipPlacement="top"
            nz-tooltip
            nz-popconfirm
            nzPopconfirmTitle="Sure to delete?"
            (nzOnConfirm)="deleteRow(data.id)"
          >
            <span nz-icon nzType="delete" nzTheme="outline"></span>
          </button>
        </ng-container>
        <ng-container *ngIf="editCache[data.id].edit">
          <button
            nz-button
            nzType="link"
            nzSize="small"
            nzTooltipTitle="Save"
            nzTooltipPlacement="top"
            nz-tooltip
            (click)="saveEdit(data.id)"
          >
            <span nz-icon nzType="check" nzTheme="outline"></span>
          </button>
          <button
            nz-button
            nzType="link"
            nzSize="small"
            nzTooltipTitle="Cancel"
            nzTooltipPlacement="top"
            nz-tooltip
            nz-popconfirm
            nzPopconfirmTitle="Sure to cancel?"
            (nzOnConfirm)="cancelEdit(data.id)"
          >
            <span nz-icon nzType="stop" nzTheme="outline"></span>
          </button>
        </ng-container>
      </td>
    </tr>
  </tbody>
</nz-table>
